#textdomain wesnoth-A_Vision_Blinded

[scenario]
    name=_"Emerging from the Depths"
    id="06_Emerging_from_the_Depths"
    map_data="{~add-ons/A_Vision_Blinded/maps/06_Emerging_from_the_Depths.map}"

    turns=80

    {SCENARIO_MUSIC underground.ogg}

    victory_when_enemies_defeated=no
    next_scenario=07_On_the_Marshes

    {UNDERGROUND}

    [side]
        type="Elvish Sorceress"
        id="Quoscelia"
		name= _ "Qouscelia"
        unrenamable=yes
        side="1"
        canrecruit="yes"
        controller="human"
        {GOLD 250 220 190}
        team_name="goodies"
        fog="no"
        share_view="no"
        shroud="yes"
        share_maps="no"
        user_team_name=_"Quoscelia"
        villages_per_scout="0"
        leader_value="3"
        village_value="1"
        income="0"
        recruit="Elvish Archer, Elvish Fighter, Elvish Scout, Elvish Shaman, Troll Whelp"
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_INTELLIGENT}
        [/modifications]
        [ai]
        [/ai]
    [/side]
    
    ##|| Enemy
    [side]
#ifdef HARD
        type="Dwarvish Lord"
#else
        type="Dwarvish Steelclad"
#endif
        id="Agtrissil"
        side="2"
        canrecruit="yes"
        {GOLD 50 70 90}
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name=_"Agtrissil"
        {INCOME 2 4 6}
#ifdef HARD
        recruit="Dwarvish Steelclad, Dwarvish Thunderer"
#else
        recruit="Dwarvish Fighter, Dwarvish Thunderer"
#endif
        [ai]
            village_value=0.0
            villages_per_scout=0
            passive_leader=no
            grouping=no
            attack_depth="5"
            caution=0
            aggression=1
        [/ai]
    [/side]

    [side]
#ifdef HARD
        type="Dwarvish Dragonguard"
#else
        type="Dwarvish Thunderguard"
#endif
        id="Agtressil"
        side="3"
        canrecruit="yes"
        {GOLD 40 60 80}
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name=_"Agtressil"
        {INCOME 2 4 6}
#ifdef HARD
        recruit="Dwarvish Fighter, Dwarvish Thunderguard"
#else
        recruit="Dwarvish Fighter, Dwarvish Thunderer"
#endif
        [ai]
            village_value=0.0
            villages_per_scout=0
            passive_leader=no
            grouping=no
            attack_depth="5"
            caution=0
            aggression=1
        [/ai]
    [/side]

    [side]
        type="Dwarvish Runemaster"
        id="Agtrassil"
        side="4"
        canrecruit="yes"
        {GOLD 30 50 70}
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name=_"Agtrassil"
        {INCOME 6 9 12}
#ifdef HARD
        recruit="Dwarvish Steelclad, Dwarvish Thunderguard"
#else
        recruit="Dwarvish Fighter, Dwarvish Thunderguard"
#endif
        [ai]
            village_value=0.0
            villages_per_scout=0
            passive_leader=no
            grouping=no
            attack_depth="5"
            caution=0
            aggression=1
            [target]
                side=1
                value=3.0
            [/target]
        [/ai]
    [/side]

    [side]
#ifdef HARD
        type="Dwarvish Sentinel"
#else
        type="Dwarvish Stalwart"
#endif
        id="Agtrossil"
        side="5"
        canrecruit="yes"
        {GOLD 0 20 40}
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name=_"Agtrossil"
        {INCOME 6 9 12}
#ifdef EASY
        recruit="Dwarvish Steelclad, Dwarvish Thunderer"
#else
        recruit="Dwarvish Steelclad, Dwarvish Thunderguard"
#endif
        [ai]
            village_value=0.0
            villages_per_scout=0
            passive_leader=no
            grouping=no
            attack_depth="5"
            caution=0
            aggression=1
            [target]
                side=1
                value=3.0
            [/target]
        [/ai]
    [/side]

    [side]
        type="Blood Bat"
        id="Fierce Bat"
        side="6"
        canrecruit="yes"
        {GOLD 15 30 45}
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name=_"Fierce Bat"
        income=0
#ifdef HARD
        recruit="Blood Bat"
#else
        recruit="Vampire Bat"
#endif
        [ai]
            grouping="offensive"
            attack_depth="5"
        [/ai]
    [/side]


    {STARTING_VILLAGES 2 5}
    {STARTING_VILLAGES 3 5}
    {STARTING_VILLAGES 4 5}
    {STARTING_VILLAGES 5 5}
    {STARTING_VILLAGES 6 5}

    [story]
        [part]
            music="revelation.ogg"
            story= _ "The elves entered into the damp, dark, narrow passage with the trolls tagging along, often having to walk in single file past the narrowest sections. The occasional bat and giant spider were no match."
        [/part]
        [part]
            story= _ "The path came to an abrupt halt. The initial despair quickly subsided at the discovery of an ancient dwarvish teleportation rune. Seeing no other choice, they placed their trust in the artefact, which took them somewhere else in the darkness."
        [/part]
        [part]
            story= _ "Soon however, the elves once again found their path blocked, but not only by boulders."
        [/part]
        [part]
            background=bg_map.png
            show_title="yes"
        [/part]
    [/story]

    [event]
        name="prestart"

        [recall]
            id=Alvelyn
        [/recall]
        [recall]
            id=Diludyren
        [/recall]
        [unit]
            type="Troll Hero"
            id="Kruurg"
            user_team_name= _ "Kruurg"
            unrenamable=yes
            side="1"
            x="44"
            y="2"
            {IS_HERO}
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [teleport]
            [filter]
                id=Quoscelia
            [/filter]
            x,y=43,3
        [/teleport]
        [teleport]
            [filter]
                id=Alvelyn
            [/filter]
            x,y=42,3
        [/teleport]
        [teleport]
            [filter]
                id=Diludyren
            [/filter]
            x,y=45,2
        [/teleport]

        [objectives]
            side="1"
            silent="no"
            [objective]
                description= _ "Break down the cave wall"
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Quoscelia"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Alvelyn"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Diludyren"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kruurg"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Time runs out"
                condition="lose"
            [/objective]
        [/objectives]
#ifdef EASY
        [set_variable]
            name="difficulty"
            value="0"
        [/set_variable]
#endif
#ifdef NORMAL
        [set_variable]
            name="difficulty"
            value="1"
        [/set_variable]
#endif
#ifdef HARD
        [set_variable]
            name="difficulty"
            value="2"
        [/set_variable]
#endif
    [/event]

    [event]
        name=start
        [message]
            speaker=Quoscelia
            message= _ "A dead end! What will become of us now?!"
        [/message]
        [message]
            speaker=Alvelyn
            message= _ "Odd that the dwarves would build a teleportation rune to a dead end... hmm... that cave wall in front doesn't look too solid, looks more like the result of a cave-in. Looks like it can be busted down if enough force is applied to it."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Kruurg
            y=4
            x=41
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall collapses before the might of the troll."
        [/message]
        [terrain]
            x=40
            y=4
            terrain=Uu
        [/terrain]
        [message]
            speaker="Alvelyn"
            message= _ "Looks like this leads into a wide cave path oft used..."
        [/message]
        [objectives]
            side="1"
            silent="no"
            [objective]
                description= _ "Investigate the caverns"
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Quoscelia"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Alvelyn"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Diludyren"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kruurg"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Time runs out"
                condition="lose"
            [/objective]
        [/objectives]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Quoscelia
            x=37
            y=5
        [/filter]
        [message]
            speaker=unit
            message= _ "Hmm, there's a plaque here: 'North to Main Cavern, South to Exit'."
        [/message]
        [message]
            speaker="Alvelyn"
            message= _ "Ha, seems we're not far. Now let's find that exit."
        [/message]
        [objectives]
            side="1"
            silent="no"
            [objective]
                description= _ "Move Quoscelia to the Southern Exit"
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Quoscelia"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Alvelyn"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Diludyren"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kruurg"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Time runs out"
                condition="lose"
            [/objective]
        [/objectives]
    [/event]

    [event]
        name=die
        [filter]
            id=Agtrissil
        [/filter]
#ifdef EASY
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="3"
            x="25"
            y="35"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="3"
            x="25"
            y="34"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef NORMAL
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="3"
            x="25"
            y="35"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="3"
            x="25"
            y="34"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef HARD
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="3"
            x="25"
            y="35"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="3"
            x="25"
            y="34"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
    [/event]

    [event]
        name=die
        [filter]
            id=Agtressil
        [/filter]
#ifdef EASY
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="4"
            x="18"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="4"
            x="17"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef NORMAL
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="4"
            x="18"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="4"
            x="17"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef HARD
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="4"
            x="18"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="4"
            x="17"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
    [/event]

    [event]
        name=die
        [filter]
            id=Agtrassil
        [/filter]
#ifdef EASY
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="5"
            x="35"
            y="60"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="5"
            x="35"
            y="61"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef NORMAL
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="5"
            x="35"
            y="60"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="5"
            x="35"
            y="61"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef HARD
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="5"
            x="35"
            y="60"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Berserker"
            id="Crazed Dwarf"
            user_team_name= _ "Crazed Dwarf"
            side="5"
            x="35"
            y="61"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=10
            y=21
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=10
            y=21
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall collapses before the might of the troll."
        [/message]
        [terrain]
            x=9
            y=21
            terrain=Uu
        [/terrain]
        [unit]
            type="Red Mage"
            id="Aethelred"
            user_team_name= _ "Aethelred"
            side="1"
            x="8"
            y="18"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        [message]
            speaker="Aethelred"
            message= _ "Who..."
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "The real question is, who are YOU, human?"
        [/message]
        [message]
            speaker="Aethelred"
            message= _ "I am Aethelred, a mage, and this is my hermitage. Two days ago, I think (since I can't see the sun), the entrance to the west of me had a massive cave-in, and I could do nothing but wait for my death. It is truly a miracle that I've been found, and I pledge my staff to your service."
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "Alright, human, you may come with us. (He looks powerful enough to be used for our purposes)"
        [/message]
        [message]
            speaker="Alvelyn"
            message= _ "Troll, can you break down the western exit this human speaks of?"
        [/message]
        [message]
            speaker="Kruurg"
            message= _ "Wall too strong. Kruurg no break."
        [/message]
        [message]
            speaker="Alvelyn"
            message= _ "Sigh... looks like the southern exit is the only way."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=25
            y=16
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=25
            y=16
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall collapses before the might of the troll."
        [/message]
        [terrain]
            x=26
            y=16
            terrain=Uu
        [/terrain]
        [message]
            speaker="Alvelyn"
            message= _ "This leads to a an abandoned path leading straight south. It should take us faster to the exit."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=33
            y=34
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=33
            y=34
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall collapses before the might of the troll."
        [/message]
        [terrain]
            x=34
            y=34
            terrain=Uu
        [/terrain]
        [message]
            speaker="Diludyren"
            message= _ "Bah! A nest of filthy bats!"
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=9
            y=35
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=9
            y=35
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall collapses before the might of the troll."
        [/message]
        [terrain]
            x=8
            y=34
            terrain=Uu
        [/terrain]
        [unit]
            type="Thug"
            id="Nath"
            user_team_name= _ "Nath"
            side="1"
            x="7"
            y="33"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
        [unit]
            type="Thug"
            id="Tramsley"
            user_team_name= _ "Tramsley"
            side="1"
            x="7"
            y="32"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [unit]
            type="Thug"
            id="Fagin"
            user_team_name= _ "Fagin"
            side="1"
            x="8"
            y="31"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        [message]
            speaker="Quoscelia"
            message= _ "Identify yourselves, humans!"
        [/message]
        [message]
            speaker="Nath"
            message= _ "I am Nath, and these two are my friends. Our little village was raided and we ran into these caves, but the dwarves took us prisoner and left us here to die."
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "You may join us against the dwarves. (these puny humans seem useful as fodder)"
        [/message]
        [message]
            speaker="Alvelyn"
            message= _ "(secretly) Seems there are human settlements nearby here..."
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "(acknowledges Alvelyn)"
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "Do you humans know where the exit to the cave is?"
        [/message]
        [message]
            speaker="Nath"
            message= _ "Yes, it's not far, though the path winds a bit to get to it."
        [/message]
        [remove_shroud]
            side=1
            x=10-19
            y=59-65
        [/remove_shroud]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=26
            y=47
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=26
            y=47
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall collapses before the might of the troll."
        [/message]
        [terrain]
            x=25
            y=48
            terrain=Uu
        [/terrain]
    [/event]

    {PLACE_IMAGE items/chest.png 4 11}

    [event]
        name=moveto
        [filter]
            x=4
            y=11
            side=1
        [/filter]
        [sound]
            name=gold.ogg
        [/sound]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "You retrieve 200 pieces of gold!"
        [/message]
        [gold]
            side=1
            amount=200
        [/gold]
        [remove_item]
        [/remove_item]
    [/event]

    [event]
        name=moveto
        [filter]
            x=0-17
            y=61-70
            id=Quoscelia
        [/filter]
        [message]
            speaker="Quoscelia"
            message= _ "Finally, sunlight again. Now let's get out and get our bearings."
        [/message]
        [endlevel]
            result=victory
            bonus=yes
        [/endlevel]
    [/event]

    [event]
        name=die
        [filter]
            id=Quoscelia
        [/filter]
        [message]
            speaker=unit
            message= _ "I have failed my duty..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Alvelyn
        [/filter]
        [message]
            speaker=unit
            message= _ "You may have defeated me, but our forests abide forever!"
        [/message]
        [message]
            speaker=Quoscelia
            message= _ "Alvs! Nooo!!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Diludyren
        [/filter]
        [message]
            speaker=unit
            message= _ "I die, but with honour. Avenge me!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Kruurg
        [/filter]
        [message]
            speaker=unit
            message= _ "Urk..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=time over
        [message]
            speaker=Quoscelia
            message= _ "By now the dwarves have surely called in an army! We are doomed!"
        [/message]
    [/event]
[/scenario]
