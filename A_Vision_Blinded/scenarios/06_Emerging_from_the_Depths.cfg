#textdomain wesnoth-A_Vision_Blinded

#define DWARF_AI
        [ai]
            passive_leader=no
            grouping=yes
            recruitment_ignore_bad_movement=yes
            recruitment_ignore_bad_combat=yes
            attack_depth="5"
            caution=0
            aggression=1
            [avoid]
                x=32-40
                y=40-50
            [/avoid]
            [target]
                side=1
                value=10
            [/target]
            [target]
                side=6
                value=0,5
            [/target]
        [/ai]
#enddef

#define KRUURG_CRUSHES_WALL X Y
        [animate_unit]
            [filter]
                id=Kruurg
            [/filter]
            flag=attack
            hits=yes
            with_bars=yes
            [primary_attack]
                name=hammer
            [/primary_attack]
            [facing]
                [filter]
                    x,y={X},{Y}
                [/filter]
            [/facing]
        [/animate_unit]
        {QUAKE "rumble.ogg"}
        [delay]
            time=200
        [/delay]
        [animate_unit]
            [filter]
                id=Kruurg
            [/filter]
            flag=attack
            hits=yes
            with_bars=yes
            [primary_attack]
                name=hammer
            [/primary_attack]
            [facing]
                [filter]
                    x,y={X},{Y}
                [/filter]
            [/facing]
        [/animate_unit]
        {QUAKE "rumble.ogg"}
        [delay]
            time=200
        [/delay]
        [animate_unit]
            [filter]
                id=Kruurg
            [/filter]
            flag=attack
            hits=yes
            with_bars=yes
            [primary_attack]
                name=hammer
            [/primary_attack]
            [facing]
                [filter]
                    x,y={X},{Y}
                [/filter]
            [/facing]
        [/animate_unit]
        {QUAKE "rumble.ogg"}
        [terrain]
            x,y={X},{Y}
            terrain=Uu^Dr
        [/terrain]
        [redraw]
            side=1
        [/redraw]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall collapses before the might of the troll."
        [/message]
        [redraw]
            side=1
        [/redraw]
        [delay]
            time=300
        [/delay]
#enddef

[scenario]
    name=_"Emerging from the Depths"
    id="06_Emerging_from_the_Depths"
    map_data="{~add-ons/A_Vision_Blinded/maps/06_Emerging_from_the_Depths.map}"

    {TURNS 53 50 47}

    {SCENARIO_MUSIC underground.ogg}

    victory_when_enemies_defeated=no
    next_scenario=07_On_the_Marshes

    {UNDERGROUND}

    [side]
        type="Elvish Sorceress"
        id="Quoscelia"
        name= _ "Qouscelia"
        unrenamable=yes
        side="1"
        canrecruit="yes"
        controller="human"
        team_name="goodies"
        fog="no"
        share_view="no"
        shroud="yes"
        share_maps="no"
        user_team_name= _ "Quoscelia"
        recruit="Elvish Archer, Elvish Fighter, Elvish Scout, Elvish Shaman, Troll Whelp"
        [modifications]
            {TRAIT_RESILIENT}
            {TRAIT_INTELLIGENT}
        [/modifications]
        {GOLD 250 220 190}
    [/side]
    
    ##|| Enemy
    [side]
#ifdef HARD
        type="Dwarvish Lord"
#else
        type="Dwarvish Steelclad"
#endif
        id="Dwarfleader_1"
        name="Agtrissil"
        side="2"
        canrecruit="yes"
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name= _ "Dwarves"
        recruit="Dwarvish Steelclad, Dwarvish Thunderer"
        {DWARF_AI}
        {GOLD 50 70 90}
    [/side]

    [side]
#ifdef HARD
        type="Dwarvish Dragonguard"
#else
        type="Dwarvish Thunderguard"
#endif
        id="Dwarfleader_2"
        name="Agtressil"
        side="3"
        canrecruit="yes"
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name= _ "Dwarves"
        {GOLD 55 70 85}
        {INCOME 6 8 10}
        recruit="Dwarvish Fighter, Dwarvish Thunderer, Dwarvish Scout"
        {DWARF_AI}
    [/side]

    [side]
        type="Dwarvish Runemaster"
        id="Dwarfleader_3"
        name="Agtressil"
        side="4"
        canrecruit="yes"
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name= _ "Dwarves"
        gold="0" ### later when Dwarfleader_2 dies
        recruit="Dwarvish Fighter, Dwarvish Thunderer"
        {DWARF_AI}
    [/side]

    [side]
#ifdef HARD
        type="Dwarvish Sentinel"
#else
        type="Dwarvish Stalwart"
#endif
        id="Dwarfleader_4"
        id="Agtrossil"
        side="5"
        canrecruit="yes"
        gold="0" ### later when Dwarfleader_2 dies
        team_name="baddies"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name= _ "Dwarves"
        recruit="Dwarvish Fighter, Dwarvish Thunderer"
        {DWARF_AI}
    [/side]

    [side]
        type="Blood Bat"
        id="Fierce Bat"
        name="Fierce Bat"
        side="6"
        canrecruit="yes"
        gold="0" # later when Dwarfleader_1 dies
        team_name="bats"
        controller="ai"
        fog="no"
        share_view="no"
        shroud="no"
        share_maps="no"
        user_team_name= _ "Fierce Bat"
        income=0
#ifdef HARD
        recruit="Blood Bat"
#else
        recruit="Vampire Bat"
#endif
        [ai]
            grouping="offensive"
            attack_depth="5"
            village_value="0"
            aggression=1
            caution=0
            [target]
                side=1
                value=40
            [/target]
            [target]
                side=2,3,4,5
                value=10
            [/target]
        [/ai]
    [/side]

        ### fake side for prisoners

    [side]
        no_leader=yes
        side="7"
        canrecruit="no"
        gold="0"
        team_name="baddies"
        controller="0"
        hidden=yes
        color=red
    [/side]


    {STARTING_VILLAGES 2 5}
    {STARTING_VILLAGES 3 5}

#ifdef EASY
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Dwarvish Steelclad) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Dwarvish Steelclad) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Steelclad) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Steelclad) 2}

        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Dwarvish Thunderguard) 0}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Dwarvish Thunderguard) 0}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Thunderguard) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Thunderguard) 1}

        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Stalwart) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Stalwart) 1}
#endif

#ifdef NORMAL
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Dwarvish Steelclad) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Dwarvish Steelclad) 2}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Steelclad) 2}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Steelclad) 3}

        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Dwarvish Thunderguard) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Dwarvish Thunderguard) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Thunderguard) 2}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Thunderguard) 2}

        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Stalwart) 2}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Stalwart) 2}
#endif

#ifdef HARD
        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Dwarvish Steelclad) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Dwarvish Steelclad) 2}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Steelclad) 3}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Steelclad) 4}

        {LIMIT_CONTEMPORANEOUS_RECRUITS 2 (Dwarvish Thunderguard) 0}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 3 (Dwarvish Thunderguard) 1}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Thunderguard) 2}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Thunderguard) 3}

        {LIMIT_CONTEMPORANEOUS_RECRUITS 4 (Dwarvish Stalwart) 3}
        {LIMIT_CONTEMPORANEOUS_RECRUITS 5 (Dwarvish Stalwart) 3}
#endif

    [story]
        [part]
            music="revelation.ogg"
            story= _ "The elves entered into the damp, dark, narrow passage with the trolls tagging along, often having to walk in single file past the narrowest sections. The occasional bat and giant spider were no match."
        [/part]
        [part]
            story= _ "The path came to an abrupt halt. The initial despair quickly subsided at the discovery of an ancient dwarvish teleportation rune. Seeing no other choice, they placed their trust in the artefact, which took them somewhere else in the darkness."
        [/part]
        [part]
            story= _ "Soon however, the elves once again found their path blocked, but not only by boulders."
        [/part]
        [part]
            background=bg_map.png
            show_title="yes"
        [/part]
    [/story]

    [event]
        name="prestart"

        [recall]
            id=Alvelyn
            x,y=44,2
        [/recall]
        [recall]
            id=Diludyren
            x,y=45,2
        [/recall]
        [unit]
            type="Troll Hero"
            id="Kruurg"
            name= _ "Kruurg"
            unrenamable=yes
            side="1"
            x="42"
            y="3"
            {IS_HERO}
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
    [/event]

    [event]
        name=start
        [message]
            speaker=Quoscelia
            message= _ "A dead end! What will become of us now?!"
        [/message]
        [message]
            speaker=Alvelyn
            message= _ "Odd that the dwarves would build a teleportation rune to a dead end... hmm... that cave wall in front doesn't look too solid, looks more like the result of a cave-in. Looks like it can be busted down if enough force is applied to it."
        [/message]
        [delay]
            time=300
        [/delay]
        {MOVE_UNIT id=Kruurg  40 4}
        [redraw]
            side=1
        [/redraw]
        {KRUURG_CRUSHES_WALL 39 5}
        [message]
            speaker="Alvelyn"
            message= _ "Looks like this leads into a wide cave path oft used..."
        [/message]
        [redraw]
            side=1
        [/redraw]
        {MOVE_UNIT id=Kruurg     37 7}
        {MOVE_UNIT id=Quoscelia  36 6}
        {MOVE_UNIT id=Alvelyn    38 5}
        {MOVE_UNIT id=Diludyren  39 5}
        [delay]
            time=600
        [/delay]
        [objectives]
            side="1"
            silent="no"
            [objective]
                description= _ "Investigate the caverns"
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Quoscelia"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Alvelyn"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Diludyren"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kruurg"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Time runs out"
                condition="lose"
            [/objective]
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Quoscelia
            x=37
            y=5
        [/filter]
        [message]
            speaker=unit
            message= _ "Hmm, there's a plaque here: 'North to Main Cavern, South to Exit'."
        [/message]
        [message]
            speaker="Alvelyn"
            message= _ "Ha, seems we're not far. Now let's find that exit."
        [/message]
        [objectives]
            side="1"
            silent="no"
            [objective]
                description= _ "Move Quoscelia to the Southern Exit"
                condition="win"
            [/objective]
            [objective]
                description= _ "Death of Quoscelia"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Alvelyn"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Diludyren"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Death of Kruurg"
                condition="lose"
            [/objective]
            [objective]
                description= _ "Time runs out"
                condition="lose"
            [/objective]
            [gold_carryover]
                bonus=yes
                carryover_percentage=40
            [/gold_carryover]
        [/objectives]
    [/event]

    [event]
        name=die
        [filter]
            id=Dwarfleader_1
        [/filter]
#ifdef EASY
        [unit]
            type="Dwarvish Ulfserker"
            id=cd1
            side="3"
            x="25"
            y="35"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id=cd2
            side="3"
            x="25"
            y="34"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef NORMAL
        [unit]
            type="Dwarvish Berserker"
            id=cd3
            side="3"
            x="25"
            y="35"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id=cd4
            side="3"
            x="25"
            y="34"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef HARD
        [unit]
            type="Dwarvish Berserker"
            id=cd5
            side="3"
            x="25"
            y="35"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Berserker"
            id=cd6
            side="3"
            x="25"
            y="34"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
        [fire_event]
            name=wake_up_side456
        [/fire_event]
    [/event]

    [event]
        name=wake_up_side456
        first_time_only=no
#ifdef EASY
        ### give gold to side 4
        [gold]
            side=4
            amount=35
        [/gold]
        ### give gold to side 5
        [gold]
            side=5
            amount=35
        [/gold]
        ### give gold to bats
        [gold]
            side=6
            amount=40
        [/gold]
#endif
#ifdef NORMAL
        ### give gold to side 4
        [gold]
            side=4
            amount=55
        [/gold]
        ### give gold to side 5
        [gold]
            side=5
            amount=55
        [/gold]
        ### give gold to bats
        [gold]
            side=6
            amount=40
        [/gold]
#endif
#ifdef HARD
        ### give gold to side 4
        [gold]
            side=4
            amount=70
        [/gold]
        ### give gold to side 5
        [gold]
            side=5
            amount=60
        [/gold]
        ### give gold to bats
        [gold]
            side=6
            amount=45
        [/gold]
#endif
    [/event]

    [event]
        name=die
        [filter]
            id=Dwarfleader_2
        [/filter]
#ifdef EASY
        [unit]
            type="Dwarvish Ulfserker"
            id=cd7
            side="4"
            x="18"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id=cd8
            side="4"
            x="17"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef NORMAL
        [unit]
            type="Dwarvish Berserker"
            id=cd9
            side="4"
            x="18"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id=cd10
            side="4"
            x="17"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef HARD
        [unit]
            type="Dwarvish Berserker"
            id=cd11
            side="4"
            x="18"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Berserker"
            id=cd12
            side="4"
            x="17"
            y="46"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
        [fire_event]
            name=wake_up_side456
        [/fire_event]
    [/event]

    [event]
        name=die
        [filter]
            id=Dwarfleader_3
        [/filter]
#ifdef EASY
        [unit]
            type="Dwarvish Ulfserker"
            id=cd13
            side="5"
            x="35"
            y="60"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id=cd14
            side="5"
            x="35"
            y="61"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef NORMAL
        [unit]
            type="Dwarvish Berserker"
            id=cd15
            side="5"
            x="35"
            y="60"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Ulfserker"
            id=cd16
            side="5"
            x="35"
            y="61"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
#ifdef HARD
        [unit]
            type="Dwarvish Berserker"
            id=cd17
            side="5"
            x="35"
            y="60"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
        [unit]
            type="Dwarvish Berserker"
            id=cd18
            side="5"
            x="35"
            y="61"
            [modifications]
                {TRAIT_LOYAL}
            [/modifications]
        [/unit]
#endif
        [fire_event]
            name=gold_to_side45
        [/fire_event]
    [/event]

    [event]
        name=gold_to_side45
        first_time_only=no
#ifdef EASY
        ### give gold to side 4
        [gold]
            side=4
            amount=35
        [/gold]
        ### give gold to side 5
        [gold]
            side=5
            amount=35
        [/gold]
        ### give income to side 5
        [modify_side]
            side=5
            income=8
        [/modify_side]
#endif
#ifdef NORMAL
        ### give gold to side 4
        [gold]
            side=4
            amount=55
        [/gold]
        ### give gold to side 5
        [gold]
            side=5
            amount=55
        [/gold]
        ### give income to side 5
        [modify_side]
            side=5
            income=10
        [/modify_side]
#endif
#ifdef HARD
        ### give gold to side 4
        [gold]
            side=4
            amount=65
        [/gold]
        ### give gold to side 5
        [gold]
            side=5
            amount=65
        [/gold]
        ### give income to side 5
        [modify_side]
            side=5
            income=12
        [/modify_side]
#endif
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x=13
            y=21
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=13
            y=21
        [/filter]
        [unit]
            type="Red Mage"
            id="Aethelred"
            name= _ "Aethelred"
            side="7"
            x="9"
            y="20"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_QUICK}
            [/modifications]
        [/unit]
        {KRUURG_CRUSHES_WALL 11 21}
        {MODIFY_UNIT (id=Aethelred) side 1}
        [delay]
            time=300
        [/delay]
        [message]
            speaker="Aethelred"
            message= _ "Who..."
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "The real question is, who are YOU, human?"
        [/message]
        [message]
            speaker="Aethelred"
            message= _ "I am Aethelred, a mage, and this is my hermitage. Two days ago, I think (since I can't see the sun), the entrance to the west of me had a massive cave-in, and I could do nothing but wait for my death. It is truly a miracle that I've been found, and I pledge my staff to your service."
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "Alright, human, you may come with us. (He looks powerful enough to be used for our purposes)"
        [/message]
        [message]
            speaker="Alvelyn"
            message= _ "Troll, can you break down the western exit this human speaks of?"
        [/message]
        [message]
            speaker="Kruurg"
            message= _ "Wall too strong. Kruurg no break."
        [/message]
        [message]
            speaker="Alvelyn"
            message= _ "Sigh... looks like the southern exit is the only way."
        [/message]
    [/event]

        ### the by-pass

    [event]
        name=moveto
        [filter]
            side=1
            x=25
            y=16
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=25
            y=16
        [/filter]
        {KRUURG_CRUSHES_WALL 26 16}
        [message]
            speaker="Alvelyn"
            message= _ "This leads to a an abandoned path leading straight south. It should take us faster to the exit."
        [/message]
        ### if the by-pass is chosen, then we wake up side 4, 5 and 6
        [fire_event]
            name=wake_up_side456
        [/fire_event]
    [/event]

        ### the by-pass exit

    [event]
        name=moveto             ### this triggers on both sides of this wall
        [filter]
            side=1
            x=26,24
            y=47,48
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=26
            y=48
        [/filter]
        {KRUURG_CRUSHES_WALL 25 48}
        [message]
            speaker="Alvelyn"
            message= _ "This leads to a an abandoned path leading straight south. It should take us faster to the exit."
        [/message]
    [/event]

    [event]
        name=moveto              ### the other side of the wall above
        [filter]
            id="Kruurg"
            x=24
            y=47
        [/filter]
        {KRUURG_CRUSHES_WALL 25 48}
        [message]
            speaker="Alvelyn"
            message= _ "Anybody in there?"
        [/message]
    [/event]

       ### the bat nest

    [event]
        name=moveto
        [filter]
            side=1
            x=33
            y=34
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=33
            y=34
        [/filter]
        {UNIT 6 (Blood Bat) 38 34 ()}
        {UNIT 6 (Blood Bat) 39 35 ()}
        {UNIT 6 (Blood Bat) 41 34 ()}
        {UNIT 6 (Blood Bat) 42 37 ()}
#ifdef NORMAL
        {UNIT 6 (Blood Bat) 40 38 ()}
        {UNIT 6 (Blood Bat) 37 36 ()}
#endif
#ifdef HARD
        {UNIT 6 (Blood Bat) 40 38 ()}
        {UNIT 6 (Blood Bat) 39 38 ()}
        {UNIT 6 (Blood Bat) 38 37 ()}
        {UNIT 6 (Blood Bat) 37 36 ()}
#endif
        {KRUURG_CRUSHES_WALL 34 34}
        [remove_shroud]
            x,y=40,35
            radius=6
            side=1
        [/remove_shroud]
        [message]
            speaker="Diludyren"
            message= _ "Bah! A nest of filthy bats!"
        [/message]
    [/event]


        ### the thugs

    [event]
        name=moveto
        [filter]
            side=1
            x=9
            y=30
        [/filter]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "The wall here does not look strong."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            id="Kruurg"
            x=9
            y=30
        [/filter]
        [unit]
            type="Thug"
            id="Nath"
            name= _ "Nath"
            side="7"
            x="6"
            y="28"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]
        [unit]
            type="Thug"
            id="Tramsley"
            name= _ "Tramsley"
            side="7"
            x="7"
            y="28"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        [unit]
            type="Thug"
            id="Fagin"
            name= _ "Fagin"
            side="7"
            x="8"
            y="28"
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]
        {KRUURG_CRUSHES_WALL         8 29}
        {MODIFY_UNIT (id=Nath)     side 1}
        {MODIFY_UNIT (id=Tramsley) side 1}
        {MODIFY_UNIT (id=Fagin)    side 1}
        [message]
            speaker="Quoscelia"
            message= _ "Identify yourselves, humans!"
        [/message]
        [message]
            speaker="Nath"
            message= _ "I am Nath, and these two are my friends. Our little village was raided and we ran into these caves, but the dwarves took us prisoner and left us here to die."
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "You may join us against the dwarves. (these puny humans seem useful as fodder)"
        [/message]
        [message]
            speaker="Alvelyn"
            message= _ "(secretly) Seems there are human settlements nearby here..."
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "(acknowledges Alvelyn)"
        [/message]
        [message]
            speaker="Quoscelia"
            message= _ "Do you humans know where the exit to the cave is?"
        [/message]
        [message]
            speaker="Nath"
            message= _ "Yes, it's not far, though the path winds a bit to get to it."
        [/message]
        [remove_shroud]
            side=1
            x=10-19
            y=59-65
        [/remove_shroud]
    [/event]


        ### the chest

    {PLACE_IMAGE items/chest.png 19 2}

    [event]
        name=moveto
        [filter]
            x=19
            y=2
            side=1
        [/filter]
        [sound]
            name=gold.ogg
        [/sound]
        [message]
            speaker=narrator
            image="wesnoth-icon.png"
            message= _ "You retrieve 200 pieces of gold!"
        [/message]
        [gold]
            side=1
            amount=200
        [/gold]
        [remove_item]
            x=19
            y=2
        [/remove_item]
    [/event]


        ### the exit

    [event]
        name=moveto
        [filter]
            x=0-17
            y=61-70
            id=Quoscelia
        [/filter]
        [message]
            speaker="Quoscelia"
            message= _ "Finally, sunlight again. Now let's get out and get our bearings."
        [/message]
        [endlevel]
            result=victory
            bonus=yes
            {NEW_GOLD_CARRYOVER 40}
        [/endlevel]
    [/event]


        ### hero deaths

    [event]
        name=die
        [filter]
            id=Quoscelia
        [/filter]
        [message]
            speaker=unit
            message= _ "I have failed my duty..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Alvelyn
        [/filter]
        [message]
            speaker=unit
            message= _ "You may have defeated me, but our forests abide forever!"
        [/message]
        [message]
            speaker=Quoscelia
            message= _ "Alvs! Nooo!!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Diludyren
        [/filter]
        [message]
            speaker=unit
            message= _ "I die, but with honour. Avenge me!"
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]
    [event]
        name=die
        [filter]
            id=Kruurg
        [/filter]
        [message]
            speaker=unit
            message= _ "Urk..."
        [/message]
        [endlevel]
            result=defeat
        [/endlevel]
    [/event]

    [event]
        name=time over
        [message]
            speaker=Quoscelia
            message= _ "By now the dwarves have surely called in an army! We are doomed!"
        [/message]
    [/event]
[/scenario]

#undef DWARF_AI
#undef KRUUG_CRUSHES_WALL X Y
